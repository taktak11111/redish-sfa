## 概要

本ドキュメントは、UI確認・要件詰めのために投入する「サンプルデータ」を、安全に作成・確認・削除するための運用手順（当面案：台帳＋ID規約）を定義する。

目的は以下：
- UIを現実に近いデータで確認し、仕様（要件）と実装の手戻りを減らす
- サンプルデータの削除をrun単位で安全に行い、環境を汚さない

---

## 重要ルール（安全性）

- **サンプルデータは必ずrun単位で識別できる形で作る**
  - `lead_id` 例：`SAMPLE-{runKey}-0001`
- **削除は必ずドライラン（件数確認）→実行の順で行う**
- **本番環境での運用は禁止**（環境ガードを将来追加予定）

---

## 仕組み（当面案）

### 台帳（Supabase）
- `public.sample_runs`
  - runKey（ユニーク）とメタ情報を管理する
- `public.sample_run_entities`
  - runで投入した各エンティティ（テーブル名＋entity_key）を記録する

### API（Next.js）
- `POST /api/sample-data/calls`
  - 架電（`call_records`）のサンプルを投入し、台帳にも記録する
- `GET /api/sample-data/cleanup?runKey=...`
  - runKeyに紐づく削除対象の件数を返す（ドライラン）
- `POST /api/sample-data/cleanup`
  - runKey単位で削除する（当面は `call_records` のみ対応）

---

## 運用手順

### 1) 架電サンプル投入（例：15件）

リクエスト（例）：
- `POST /api/sample-data/calls`

body例：
```json
{
  "count": 15,
  "staffIS": "田邊",
  "leadSource": "TEMPOS",
  "label": "ui calls 15"
}
```

レスポンス例：
- `runKey`（削除・再現のキー）
- `insertedCount`
- `leadIds`

投入後は、架電管理ページをリロードしてUI確認する。

---

### 2) 削除対象の確認（ドライラン）

例：
- `GET /api/sample-data/cleanup?runKey=<runKey>`

期待する結果：
- テーブルごとの件数（当面は `call_records` の件数）

---

### 3) サンプル削除（run単位）

例：
- `POST /api/sample-data/cleanup`

body例：
```json
{
  "runKey": "<runKey>"
}
```

期待する結果：
- 削除した件数（`call_records`）
- runが削除されたこと（台帳はCASCADEで消える）

---

## 拡張方針（次にやること）

当面は「架電（call_records）」のみだが、将来的に以下へ拡張する：
- 商談（deals）
- 成約（contracts など）
- 他システム

拡張時の原則：
- 各ドメインで **entity_key（例：deal_id / contract_id）** を `sample_run_entities` に記録
- cleanupはrun単位で「対象テーブル→親→run」の順に削除する

