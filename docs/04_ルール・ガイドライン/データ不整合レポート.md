# CSVファイルとデータベースの不整合レポート

**作成日**: 2026-01-16  
**CSVファイル**: `Ver2.0_セールス管理統合シート - 架電管理表 (5).csv`

## 不整合の概要

### 総不整合件数
- **修正が必要**: 867件（OMC: 171件 + TEMPOS: 696件）
- **要確認**: 279件（OMC: 145件 + TEMPOS: 134件）

---

## 【カテゴリ1】OMCリードでCSVにデータがあるのにDBが未架電

**件数**: 171件  
**問題**: CSVファイルには架電データ（status_is, call_count, result_contact_status等）があるが、データベースでは「未架電」になっている

### サンプルレコード（最初の30件）

| リードID | CSVデータ | DB状態 |
|---------|----------|--------|
| OC0013 | status_is=09.アポ獲得, result=通電, staff_is=小林 | status=未架電 |
| OC0047 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0052 | status_is=03.アポイント獲得済, call_count=1, result=不通, staff_is=田邊 | status=未架電 |
| OC0057 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0058 | status_is=03.アポイント獲得済, call_count=3, result=通電, staff_is=田邊 | status=未架電 |
| OC0059 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0060 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0080 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0086 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0091 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0096 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0102 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0105 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0108 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0140 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0141 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0142 | status_is=02.コンタクト試行中, call_count=2, result=通電, staff_is=田邊 | status=未架電 |
| OC0143 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0144 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0145 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0146 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0147 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0148 | status_is=03.アポイント獲得済, result=未架電, staff_is=田邊 | status=未架電 |
| OC0149 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0150 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0151 | status_is=02.コンタクト試行中, call_count=3, result=不通, staff_is=田邊 | status=未架電 |
| OC0152 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0153 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0154 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| OC0155 | status_is=03.アポイント獲得済, call_count=1, result=通電, staff_is=田邊 | status=未架電 |

**他141件**（OC0156以降）

---

## 【カテゴリ2】OMCリードでCSVにデータが空

**件数**: 145件  
**問題**: CSVファイルに架電データ（status_is, call_count, result_contact_status等）が入力されていない

### サンプルレコード（最初の30件）

OC0001, OC0002, OC0003, OC0004, OC0005, OC0006, OC0007, OC0008, OC0009, OC0010, OC0011, OC0012, OC0014, OC0015, OC0016, OC0017, OC0018, OC0019, OC0020, OC0021, OC0022, OC0023, OC0024, OC0025, OC0026, OC0027, OC0028, OC0029, OC0030, OC0031

**他115件**

**注意**: これらのレコードは、CSVファイルに架電データが入力されていないため、データベースの状態を確認する必要があります。

---

## 【カテゴリ3】TEMPOSリードでCSVにデータがあるのにDBが未架電（直近7日以外）

**件数**: 696件  
**問題**: CSVファイルには架電データ（status_is, call_count, result_contact_status等）があるが、データベースでは「未架電」になっている（連携日が7日以上前）

### サンプルレコード（最初の30件）

| リードID | CSVデータ | DB状態 |
|---------|----------|--------|
| TM3600 | status_is=90.失注, result=未通, staff_is=加藤 | status=未架電 |
| TM3601 | status_is=90.失注, result=未通, staff_is=加藤 | status=未架電 |
| TM3603 | status_is=03.アポイント獲得済, call_count=2, result=通電, staff_is=田邊 | status=未架電 |
| TM3605 | status_is=90.失注, result=未通, staff_is=加藤 | status=未架電 |
| TM3606 | status_is=通電, call_count=5, result=通電, staff_is=加藤 | status=未架電 |
| TM3607 | status_is=失注, call_count=5, result=通電, staff_is=加藤 | status=未架電 |
| TM3609 | status_is=90.失注, call_count=2, result=未通, staff_is=加藤 | status=未架電 |
| TM3610 | status_is=90.失注, call_count=2, result=通電, staff_is=田邊 | status=未架電 |
| TM3613 | status_is=失注, call_count=4, result=通電, staff_is=田邊 | status=未架電 |
| TM3614 | status_is=02.コンタクト試行中, call_count=6, result=不通, staff_is=田邊 | status=未架電 |
| TM3618 | status_is=失注, call_count=5, result=不通, staff_is=加藤 | status=未架電 |
| TM3621 | status_is=失注, call_count=4, result=通電, staff_is=田邊 | status=未架電 |
| TM3622 | status_is=90.失注, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| TM3624 | status_is=90.失注, call_count=2, result=未通, staff_is=加藤 | status=未架電 |
| TM3625 | status_is=90.失注, call_count=3, result=通電, staff_is=田邊 | status=未架電 |
| TM3630 | status_is=04.失注, call_count=1, result=通電, staff_is=小林 | status=未架電 |
| TM3632 | status_is=04.失注, result=通電, staff_is=小林 | status=未架電 |
| TM3634 | status_is=90.失注, call_count=7, result=未通, staff_is=加藤 | status=未架電 |
| TM3635 | status_is=04.失注, result=通電, staff_is=小林 | status=未架電 |
| TM3637 | status_is=90.失注, result=未通, staff_is=加藤 | status=未架電 |
| TM3638 | status_is=90.失注, result=通電, staff_is=加藤 | status=未架電 |
| TM3640 | status_is=04.失注, result=通電, staff_is=小林 | status=未架電 |
| TM3643 | status_is=失注, call_count=1, result=通電, staff_is=田邊 | status=未架電 |
| TM3645 | status_is=失注, result=未通, staff_is=加藤 | status=未架電 |
| TM3650 | status_is=失注, result=未通, staff_is=加藤 | status=未架電 |
| TM3651 | status_is=失注, result=通電, staff_is=加藤 | status=未架電 |
| TM3653 | status_is=失注, result=通電, staff_is=加藤 | status=未架電 |
| TM3661 | status_is=90.失注, result=未通電, staff_is=加藤 | status=未架電 |
| TM3663 | status_is=失注, result=通電, staff_is=加藤 | status=未架電 |
| TM3665 | status_is=失注, result=通電, staff_is=加藤 | status=未架電 |

**他666件**

---

## 【カテゴリ4】TEMPOSリードでCSVにデータが空（直近7日以外）

**件数**: 134件  
**問題**: CSVファイルに架電データ（status_is, call_count, result_contact_status等）が入力されていない（連携日が7日以上前）

### サンプルレコード（最初の30件）

TM3681, TM3688, TM3696, TM3713, TM3720, TM3739, TM3741, TM3755, TM3767, TM3768, TM3807, TM3808, TM3814, TM3831, TM3850, TM3901, TM3674 (linked_date=2024-01-24), TM3692 (linked_date=2024-01-30), TM3710 (linked_date=2024-02-05), TM3774 (linked_date=2024-02-21), TM3778 (linked_date=2024-02-21), TM3794 (linked_date=2024-02-26), TM3804 (linked_date=2024-02-27), TM3812 (linked_date=2024-03-01), TM3824 (linked_date=2024-03-07), TM3826 (linked_date=2024-03-08), TM3832 (linked_date=2024-03-12), TM3833 (linked_date=2024-03-12), TM3858 (linked_date=2024-03-19), TM3867 (linked_date=2024-03-22)

**他104件**

**注意**: これらのレコードは、CSVファイルに架電データが入力されていないため、データベースの状態を確認する必要があります。

---

## 根本原因

1. **CSVファイルの列マッピングの誤り**: 以前のインポート処理で、列インデックスが1列ずれていた可能性があります。
   - 正しい列インデックス（OC0280の解析結果）:
     - 担当IS: インデックス22 (V列)
     - ISステータス: インデックス23 (W列)
     - ステータス更新日: インデックス24 (X列)
     - 結果/コンタクト状況: インデックス27 (AA列)
     - 直近架電日: インデックス28 (BA列)
     - 架電数カウント: インデックス29 (CA列)

2. **インポート処理のデフォルト値**: 新規レコード作成時に、`status='未架電'`と`call_count=0`がデフォルト値として設定されていたため、CSVファイルのデータが正しく反映されなかった可能性があります。

3. **既存レコード更新時のデータ保持ロジック**: 既存レコード更新時に、CSVファイルに含まれていないフィールドを保持するロジックが、逆にCSVファイルのデータを上書きしてしまった可能性があります。

---

## 修正方針

1. **CSVファイル全体を再インポート**: 正しい列インデックスを使用して、CSVファイル全体を再インポートする
2. **一括修正スクリプトの実行**: CSVファイルのデータに基づいて、データベースの不整合を一括修正する
3. **インポート処理の修正**: `upload/route.ts`と`sync/route.ts`の列マッピングを修正し、今後のインポートで正しく動作するようにする

---

## 次のステップ

1. CSVファイル全体を読み込み、正しい列インデックスでデータを抽出
2. データベースと照合し、不整合があるレコードを特定
3. 一括修正スクリプトで更新
