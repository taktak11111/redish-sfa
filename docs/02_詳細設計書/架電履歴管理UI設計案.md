# 架電履歴管理UI設計案

## 1. データ構造の拡張

### CallRecord型への追加
```typescript
export interface CallHistory {
  id: string // 履歴ID（自動生成）
  callDate: string // 架電日（YYYY-MM-DD）
  callTime?: string // 架電時刻（HH:mm）
  staffIS: string // 担当IS
  status: CallHistoryStatus // 架電状況
  result?: string // 結果（通話できた、不通、再架電依頼など）
  duration?: number // 通話時間（秒）
  memo?: string // メモ
  createdAt: Date // 作成日時
}

export type CallHistoryStatus = 
  | '不通'
  | '通話できた'
  | '再架電依頼'
  | 'アポ獲得'
  | '不在'
  | '拒否'
  | 'その他'

export interface CallRecord {
  // ... 既存のフィールド
  callHistory?: CallHistory[] // 架電履歴配列
}
```

## 2. UI設計

### 2.1 配置場所
- **CallDetailPanel**の「架電管理」セクション内に「架電履歴」サブセクションを追加
- 「直近架電日」「架電数カウント」の下に配置

### 2.2 レイアウト設計

#### オプションA: タイムライン形式（推奨）
```
┌─────────────────────────────────────┐
│ 架電履歴                              │
│ ┌─────────────────────────────────┐ │
│ │ 2024/01/15 14:30  [通話できた]   │ │
│ │ 担当: 担当者A                     │ │
│ │ 通話時間: 5分                     │ │
│ │ メモ: アポ獲得の可能性あり         │ │
│ │ [編集] [削除]                     │ │
│ └─────────────────────────────────┘ │
│ ┌─────────────────────────────────┐ │
│ │ 2024/01/10 10:00  [不通]        │ │
│ │ 担当: 担当者B                     │ │
│ │ メモ: 電話に出ず                 │ │
│ │ [編集] [削除]                     │ │
│ └─────────────────────────────────┘ │
│ [+ 架電履歴を追加]                   │
└─────────────────────────────────────┘
```

#### オプションB: テーブル形式
```
┌─────────────────────────────────────────────┐
│ 架電履歴                                     │
│ ┌──────┬──────┬──────┬──────┬──────┐      │
│ │日付   │時刻  │担当  │状況  │操作  │      │
│ ├──────┼──────┼──────┼──────┼──────┤      │
│ │01/15 │14:30 │担当A │通話  │編集削除│      │
│ │01/10 │10:00 │担当B │不通  │編集削除│      │
│ └──────┴──────┴──────┴──────┴──────┘      │
│ [+ 架電履歴を追加]                          │
└─────────────────────────────────────────────┘
```

### 2.3 機能要件

#### 2.3.1 履歴一覧表示
- 時系列順（新しい順）で表示
- 各履歴に以下を表示：
  - 架電日時（日付 + 時刻）
  - 担当者名
  - 状況バッジ（色分け）
  - 通話時間（該当する場合）
  - メモ（簡易表示、クリックで詳細表示）
  - 編集・削除ボタン

#### 2.3.2 履歴追加
- 「+ 架電履歴を追加」ボタンでモーダルを開く
- モーダル内で以下を入力：
  - 架電日（デフォルト：今日）
  - 架電時刻（オプション）
  - 担当IS（ドロップダウン）
  - 状況（ドロップダウン）
  - 結果（状況に応じて表示）
  - 通話時間（通話できた場合）
  - メモ（テキストエリア）
- 保存時に自動で：
  - `callCount`をインクリメント
  - `lastCalledDate`を最新の架電日に更新

#### 2.3.3 履歴編集
- 各履歴の「編集」ボタンでモーダルを開く
- 追加時と同じフォームで編集可能

#### 2.3.4 履歴削除
- 各履歴の「削除」ボタンで確認ダイアログを表示
- 削除時に自動で：
  - `callCount`をデクリメント
  - `lastCalledDate`を更新（最新の履歴から）

### 2.4 状況バッジの色分け
- **通話できた**: 緑（`badge-success`）
- **アポ獲得**: 濃い緑（`badge-success`、強調）
- **再架電依頼**: 青（`badge-info`）
- **不通**: グレー（`badge-gray`）
- **不在**: 黄色（`badge-warning`）
- **拒否**: 赤（`badge-danger`）
- **その他**: グレー（`badge-gray`）

### 2.5 リストリサイクル連携
- 履歴一覧から「再架電依頼」の履歴を強調表示
- リサイクル優先度と連動して、次回アクション日を自動提案
- 履歴から「ネクストアクション日」を自動設定可能

## 3. 実装イメージ

### 3.1 履歴カードコンポーネント
```tsx
<CallHistoryCard
  history={history}
  onEdit={() => openEditModal(history)}
  onDelete={() => deleteHistory(history.id)}
/>
```

### 3.2 履歴追加/編集モーダル
```tsx
<CallHistoryModal
  isOpen={isModalOpen}
  history={editingHistory} // 編集時は既存履歴、追加時はnull
  onClose={() => setIsModalOpen(false)}
  onSave={(history) => saveHistory(history)}
/>
```

## 4. ユーザーフロー

### 4.1 架電履歴の追加
1. CallDetailPanelを開く
2. 「架電管理」セクションを展開
3. 「架電履歴」セクションまでスクロール
4. 「+ 架電履歴を追加」ボタンをクリック
5. モーダルで情報を入力
6. 「保存」ボタンをクリック
7. 履歴一覧に追加され、`callCount`と`lastCalledDate`が自動更新

### 4.2 リストリサイクル活用
1. 履歴一覧で「再架電依頼」の履歴を確認
2. リサイクル優先度を設定
3. 「ネクストアクション日」を履歴から自動設定
4. 次回架電時に履歴を参照して効率的にアプローチ

## 5. 技術的な考慮事項

### 5.1 パフォーマンス
- 履歴が多い場合（100件以上）はページネーションまたは仮想スクロールを検討
- 初期表示は最新10件程度に制限し、「もっと見る」で追加読み込み

### 5.2 データ整合性
- 履歴削除時に`callCount`が負の値にならないようバリデーション
- 履歴がない場合の`lastCalledDate`の扱いを明確化

### 5.3 アクセシビリティ
- キーボード操作でモーダルを開閉可能
- スクリーンリーダー対応
- フォーカス管理

## 6. 今後の拡張案

- 架電履歴のエクスポート機能
- 架電履歴の統計表示（成功率、平均通話時間など）
- 架電履歴のフィルタリング（担当者、状況、期間）
- 架電履歴の一括編集機能





