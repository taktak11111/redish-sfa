# 開発環境初期ユーザー作成手順

## 問題
`usersテーブルにユーザーが存在しません` というエラーが表示される場合、`users`テーブルが空の状態です。

## 原因
`users`テーブルは`auth.users`テーブルへの外部キー制約があるため、`auth.users`テーブルにユーザーが存在する必要があります。

## 解決方法

### 方法1: Supabaseダッシュボードから手動で作成（推奨）

#### ステップ1: auth.usersテーブルにユーザーを作成

1. **Supabaseダッシュボードにログイン**
   - https://supabase.com/dashboard にアクセス
   - プロジェクトを選択

2. **Authentication → Users を開く**
   - 左メニューから「Authentication」→「Users」を選択

3. **ユーザーを追加**
   - 「Add user」ボタンをクリック
   - Email: `tmatsukuma@redish.jp`
   - Password: 任意のパスワード（開発環境なので簡単でOK）
   - 「Auto Confirm User」にチェックを入れる
   - 「Create user」をクリック

4. **ユーザーIDをコピー**
   - 作成されたユーザーのUUIDをコピー（例: `12345678-1234-1234-1234-123456789abc`）

#### ステップ2: usersテーブルにユーザーを追加

1. **SQLエディタを開く**
   - 左メニューから「SQL Editor」を選択

2. **以下のSQLを実行**（ステップ1でコピーしたUUIDに置き換える）

```sql
INSERT INTO users (id, email, full_name, role, department)
VALUES (
  'ここにステップ1でコピーしたUUIDを貼り付け',
  'tmatsukuma@redish.jp',
  '開発ユーザー',
  'admin',
  '開発'
)
ON CONFLICT (email) 
DO UPDATE SET role = 'admin';
```

3. **実行ボタンをクリック**

4. **確認**
   - 設定画面をリロード
   - 「ユーザー権限」タブで「管理者」と表示されれば成功

### 方法2: SQLエディタから一括で作成

1. **Supabaseダッシュボード → SQLエディタを開く**

2. **以下のSQLを実行**

```sql
-- 1. auth.usersテーブルにユーザーを作成（存在しない場合）
-- 注意: この方法はSupabaseのバージョンによっては動作しない場合があります
-- その場合は、方法1を使用してください

-- 2. 作成されたユーザーIDを取得して、usersテーブルに追加
-- まず、auth.usersテーブルからユーザーIDを確認
SELECT id, email FROM auth.users WHERE email = 'tmatsukuma@redish.jp';

-- 3. 上記で取得したIDを使用してusersテーブルに追加
-- （IDをコピーして以下のSQLに貼り付けて実行）
INSERT INTO users (id, email, full_name, role, department)
VALUES (
  'ここに上記で取得したIDを貼り付け',
  'tmatsukuma@redish.jp',
  '開発ユーザー',
  'admin',
  '開発'
)
ON CONFLICT (email) 
DO UPDATE SET role = 'admin';
```

### 方法3: 既存のauth.usersユーザーを使用

既に`auth.users`テーブルにユーザーが存在する場合：

1. **Supabaseダッシュボード → Authentication → Users**
   - 既存のユーザーを確認
   - ユーザーIDをコピー

2. **SQLエディタで以下を実行**

```sql
INSERT INTO users (id, email, full_name, role, department)
VALUES (
  '既存のauth.usersテーブルのユーザーID',
  '既存のメールアドレス',
  '開発ユーザー',
  'admin',
  '開発'
)
ON CONFLICT (email) 
DO UPDATE SET role = 'admin';
```

## 確認方法

1. **設定画面を開く**
   - `http://localhost:3000/settings`

2. **「ユーザー権限」タブを選択**

3. **「現在のユーザー情報」セクションを確認**
   - 権限が「管理者」と表示されていれば成功
   - 「カスタムフィールドを追加」ボタンが表示されていれば成功

## トラブルシューティング

### エラー: "duplicate key value violates unique constraint"

**原因**: 既に`users`テーブルに同じメールアドレスのユーザーが存在する

**解決方法**: 以下のSQLで既存ユーザーを更新

```sql
UPDATE users 
SET role = 'admin',
    full_name = '開発ユーザー',
    department = '開発'
WHERE email = 'tmatsukuma@redish.jp';
```

### エラー: "insert or update on table "users" violates foreign key constraint"

**原因**: `auth.users`テーブルに指定したIDのユーザーが存在しない

**解決方法**: 
1. `auth.users`テーブルにユーザーが存在するか確認
2. 存在しない場合は、方法1でユーザーを作成してから再度実行

### エラー: "permission denied for table auth.users"

**原因**: SQLエディタから`auth.users`テーブルに直接アクセスできない

**解決方法**: 
- `auth.users`テーブルへの操作は、Supabaseダッシュボードの「Authentication」→「Users」から行う
- SQLエディタでは`users`テーブルのみ操作する
