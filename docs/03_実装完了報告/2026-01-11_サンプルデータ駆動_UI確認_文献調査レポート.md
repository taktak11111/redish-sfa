## サンプルデータ駆動_UI確認_文献調査レポート（2026-01-11）

### 0. 目的

本レポートは、UI確認のためにサンプルデータを投入しながら仕様・ロジック・UIを固め、一定段階で安全にサンプルを消去して実データへ移行していく、という開発手順について、理論的根拠・実務ノウハウ・Pros/Consを文献ベースで整理する。

対象読者：開発/PM/QA/運用（意思決定者含む）

---

### 1. 結論（推奨案/理想案）

#### 推奨（当面案）
- **同一環境（Dev）で運用**しつつ、サンプルを **run単位で識別・追跡**して安全に削除できる仕組み（台帳＋ID規約）を先に整備する。
- 仕様・UIの合意形成は **具体例（Examples）** を中心に回し、要件の曖昧さを減らす。

#### 理想（中長期）
- **環境分離（Preview/Branch/Ephemeral）** と **自動シード＋自動破棄** を基盤にし、誤削除を「プロセス」ではなく「構造」で潰す。

---

### 2. 理論的根拠（なぜサンプルデータ駆動が有効か）

#### 2.1 Specification by Example（SBE）
要求を抽象的に書くだけではなく、**具体例（現実の入力/出力）**で仕様を合意する。結果として、コミュニケーション齟齬を減らし、手戻りを減らし、仕様を“生きたドキュメント”にできる。

- 根拠：
  - Gojko Adzic, *Specification by Example*（書籍）  
    - `https://www.manning.com/books/specification-by-example`
  - Agile Alliance（SBE紹介）  
    - `https://www.agilealliance.org/resources/books/specification-by-example/`

#### 2.2 Example Mapping（SBEの実践手法）
ユーザーストーリーから **ルール** と **具体例** と **未解決の疑問** を整理し、要件の穴を早期に見つける。サンプルデータは“具体例”の最短実装として相性が良い。

- 根拠：
  - Lisa Crispin, “Experimenting with Example Mapping”  
    - `https://lisacrispin.com/2016/06/02/experiment-example-mapping/`
  - Qiita 実践例（日本語）  
    - `https://qiita.com/TairaNozawa/items/73d419dddf15f3fe33cc`

---

### 3. 実務ノウハウ（テストデータ/シードの運用）

#### 3.1 シード/フィクスチャ運用の典型
開発環境での初期データ投入（seed）や、テストデータ管理（fixture）は一般的で、再現性・効率の観点で有効。

- 根拠（例）：
  - Railsのseed/resetの説明（Zenn）  
    - `https://zenn.dev/ganmo3/articles/91d0b92ab9c30d`
  - Sequelizeのseed/undoの説明（Qiita）  
    - `https://qiita.com/furi-kake/items/c47b098cdcf053bcf287`
  - Rails fixtureを活用したテスト/デモデータ管理（Qiita）  
    - `https://qiita.com/sanak/items/016f2317971f37bc779b`

#### 3.2 冪等性（Idempotency）の重要性
シードは繰り返し実行されることが多く、二重投入を避けるための **冪等性**（同じ操作を複数回しても状態が壊れない）が重要。

- 根拠：
  - “Database seeding best practices（Idempotency / Environment awareness）”  
    - `https://www.fakerbox.com/blog/database-seeding-best-practices`

---

### 4. 理想案の根拠（環境分離＋自動シード＋破棄）

#### 4.1 Ephemeral/Preview environments
環境を短命にし、CI/CDで **自動で作って自動で消す**。データは作り直し可能（seed）にすることで、誤削除・汚染・長期運用の負債が減る。

- 根拠：
  - Ephemeral environments best practices（自動シード/自動破棄/分離）  
    - `https://ephemeral-environments.com/guides/ephemeral-environments-best-practices`

#### 4.2 Supabase branching + seeding
ブランチ（Preview）を作り、seed.sqlで初期データを投入する運用が公式に案内されている（環境分離の実装手段）。

- 根拠：
  - Supabase Branching（Preview branches）  
    - `https://supabase.com/docs/guides/deployment/branching`
  - Supabase Seeding  
    - `https://supabase.com/docs/guides/local-development/seeding-your-database`

---

### 5. Pros / Cons（手順としての評価）

#### Pros（狙いに対して強い点）
- **合意形成が早い**：具体例ベースで仕様が固まる（SBE/Example Mappingの狙いと一致）
- **UI/ロジック/要件の往復が短い**：サンプルで再現→修正→再確認が回る
- **移行リスクの前倒し**：欠損・例外・集計不整合などを早期に発見しやすい

#### Cons（失敗パターン）
- **サンプルに最適化しすぎる**：実データの汚さ（欠損/揺れ/例外）で後半に破綻
- **削除事故のリスク**：同一環境で“消す”運用は最重要リスク（構造で潰す必要）
- **メトリクス汚染**：KPI/分析の検証がサンプル混入で誤る

---

### 6. 当面案（台帳＋ID規約）を推す理由（理論→実装への接続）

当面案は、次の2点で“理想（環境分離）”へ移行しやすい。
- **SBE/Example Mapping**の「具体例を中心に仕様を固める」思想を、run単位のサンプルとして運用に落とせる
- **安全削除**を、単なる運用注意ではなく「runで束ねる構造」に寄せられる

ただし、最終的には **環境分離（Preview/Branch）** が安全性の上限である。

---

### 7. 今後のドキュメント/運用（本プロジェクトの実装状況）

当面案（台帳＋ID規約）の運用ガイド：
- `docs/04_ルール・ガイドライン/サンプルデータ運用ガイド.md`

---

### 8. 参考（関連：技術的負債を溜めない“後始末”の考え方）

「後で消す」対象は、サンプルデータだけでなく feature flag 等にも共通する。短命な仕組みは“消す計画”を最初から持つことで負債化を防げる。

- LaunchDarkly（Feature flags technical debt）  
  - `https://launchdarkly.com/docs/guides/flags/technical-debt`

---

### 9. 参考文献サマリー（要点と、REDISH_SFAでの適用方法）

※ここでは、本文で引用したURLごとに「サマリー」「ポイント」「今回適用できる方法」を整理する（根拠＝各URLに基づく）。

| # | 出典URL | サマリー | ポイント（抜粋） | REDISH_SFAでの適用方法（今回） |
|---:|---|---|---|---|
| 1 | `https://www.manning.com/books/specification-by-example` | Specification by Example（SBE）を、実プロジェクトの学び（多数事例）として体系化した書籍紹介。仕様を具体例で合意し、頻繁に検証し、“生きたドキュメント”にする流れを重視している。 | - 具体例で期待値を定義し、誤解/手戻りを減らす<br>- 頻繁な検証（validation）<br>- 生きたドキュメント（living documentation） | - 架電管理のUI/ロジックを「具体例（サンプルデータ）」中心で詰める（例：不通1→不通2、架電中は同時に1件のみ等）<br>- “例”をそのまま運用ガイド/要件の根拠に残す（docsに残す） |
| 2 | `https://www.agilealliance.org/resources/books/specification-by-example/` | Agile AllianceのSBE（書籍/関連リソース）紹介ページ。SBEを「具体例で要件・受入テストを明確化し、関係者の共通理解を作る」アプローチとして扱う。 | - 抽象ではなく具体例で共有理解を作る<br>- 仕様＝テスト可能な形で明確化 | - 「架電一覧/詳細」で揉めやすい仕様（表示条件、集計定義、状態遷移）を“例”で先に固定し、実装のやり直しを減らす |
| 3 | `https://lisacrispin.com/2016/06/02/experiment-example-mapping/` | Example Mappingを、Three Amigos（ビジネス/開発/テスト）でユーザーストーリーの目的・ルール・例を整理する手法として紹介。事前計画（pre-iteration planning）を改善する目的で使っている。 | - 目的（goal）→ルール→例の順で整理<br>- 例はビジネス向けテスト（受入れの判断材料）にもなる | - 架電管理の「ゴール（KPI/運用）」→「ルール（状態・制約）」→「例（サンプルデータ/画面）」をセットで合意する（UI検討会の型にする） |
| 4 | `https://qiita.com/TairaNozawa/items/73d419dddf15f3fe33cc` | Example Mappingの実践と標準化の過程を共有。ステークホルダーを巻き込むことでルールの洗練や新しいルールの発見が起こること、モック/画面を見ながら議論すると有効なことが述べられている。 | - ステークホルダー参加でルールが洗練/発見される<br>- モック/画面を見ながらが効果的<br>- 発散→収束で進める | - UI確認（サンプルデータ表示）を“会議の共通物”にして、要件→実装のズレを早期に回収する（架電管理の改善サイクルに組み込む） |
| 5 | `https://zenn.dev/ganmo3/articles/91d0b92ab9c30d` | Railsの`seeds.rb`で初期データ投入を行い、必要に応じて`db:reset`でDBをリセットしてseedをやり直す運用を説明（本番でのresetは避ける注意も含む）。 | - seedは開発/テストで有用<br>- resetはDBを作り直してseedを再適用する流れ（本番では注意） | - 本番相当データを“手作業で整える”より、Devでは「作り直せる」データ投入経路を用意する<br>- ただし本プロジェクトではDB全消しではなく、run単位削除（台帳）で安全側に倒す |
| 6 | `https://qiita.com/furi-kake/items/c47b098cdcf053bcf287` | Sequelizeでseedを投入（`db:seed:all`）し、undoで取り消す（`db:seed:undo`等）方法を紹介。 | - seed投入/取り消し（undo）をコマンドで管理できる | - REDISH_SFAでは「サンプル投入」と「安全な削除」をAPI化しているため、同じ思想（投入とロールバックのペア）をrun単位で徹底する |
| 7 | `https://qiita.com/sanak/items/016f2317971f37bc779b` | Rails fixture（YAML）を使ってテスト/デモデータを管理し、必要に応じてDB内容をfixture化して復元する運用例。 | - データを定義ファイルで管理しやすい<br>- 復元（再現性）に寄与 | - 将来、架電/商談/成約も含め「UI検証セット」をrun単位で再現できるように、投入パターン（テンプレ）を整備する（fixture的な考え方） |
| 8 | `https://www.fakerbox.com/blog/database-seeding-best-practices` | シード運用のベストプラクティスとして、冪等性（idempotent）や環境ごとの扱い（environment awareness）などを重視する整理。 | - 冪等性（重複投入しない/繰り返し安全）<br>- 環境別の安全策（本番での投入抑止など） | - サンプル生成APIは「runKey＋固定ID規約＋upsert」で冪等に寄せる（再実行しても壊れない）<br>- 本番環境ガード（将来）を“仕様”として先に固定する |
| 9 | `https://ephemeral-environments.com/guides/ephemeral-environments-best-practices` | Ephemeral環境は「必要なときに作り、不要になったら自動で壊す」短命な分離環境。seed/teardownの自動化やTTLで“放置しない”ことを推奨している。 | - 自動作成/自動破棄<br>- seedの仕組みを持つ<br>- TTL等で放置を防ぐ | - 中長期の理想案として、PRごとのPreview環境＋seedを検討（誤削除/汚染のリスク上限を下げる） |
| 10 | `https://supabase.com/docs/guides/deployment/branching` | SupabaseのPreview Branch（分離環境）を作り、本番に影響を与えず検証できる仕組みを公式が案内している。 | - ブランチで環境分離ができる<br>- Previewで検証→本番へ | - “理想案”の実装手段：DBスキーマ変更やサンプル投入をPreviewで先に検証し、安定後に本番へ |
| 11 | `https://supabase.com/docs/guides/local-development/seeding-your-database` | Supabaseのseed.sql（複数ファイルも可）で、ローカル/リセット時に初期データを投入する方法を公式が案内している。 | - `seed.sql`（または複数sql_paths）<br>- マイグレーション後にseedが適用される | - ローカル開発（CLI）ではseed.sql/seed群で検証データを素早く用意できる<br>- 本番相当の検証はPreview Branch＋seedで再現性を担保 |
| 12 | `https://launchdarkly.com/docs/guides/flags/technical-debt` | フィーチャーフラグは放置すると技術的負債になるため、作成時点で「消す計画」を持ち、定期的に棚卸しして整理することを推奨している。 | - 旗（フラグ）にはライフサイクルが必要<br>- 定期レビュー/整理で負債化を防ぐ | - サンプルデータも“短命な仕組み”として、run単位の棚卸し・削除（cleanup）を運用の定義に入れる（放置＝負債化） |

