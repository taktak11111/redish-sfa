# REDISH SFA Webアプリ化 企画書・要件定義書

## 1. エグゼクティブサマリー

### 1.1 プロジェクト概要

| 項目 | 内容 |
|------|------|
| **プロジェクト名** | REDISH SFA Webアプリ化プロジェクト |
| **目的** | 既存Google SpreadsheetベースのSFAをWebアプリとして再構築 |
| **データベース** | 既存Googleスプレッドシートを継続利用（DB代替） |
| **フロントエンド** | モダンWebアプリケーション（React/Next.js推奨） |
| **対象ユーザー** | REDISH株式会社 営業チーム |

### 1.2 現状の課題

1. **操作性の制約**: スプレッドシートUIでの複雑なワークフロー操作
2. **同時編集の制限**: 複数ユーザーでの編集競合リスク
3. **モバイル対応**: スプレッドシートのモバイル操作性の低さ
4. **自動化の分散**: 13個のGASが個別に動作し、全体像が把握困難
5. **エラーハンドリング**: ユーザーフレンドリーなエラー表示の欠如

### 1.3 期待される効果

1. **UX向上**: 直感的なWebインターフェースによる操作効率化
2. **データ整合性**: APIを通じた一元的なデータ操作
3. **可視性向上**: ダッシュボードによるKPIリアルタイム表示
4. **拡張性**: 将来的なDB移行への準備
5. **モバイル対応**: レスポンシブデザインによるマルチデバイス対応

---

## 2. 現状システム分析（As-Is）

### 2.1 シート構成と役割

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        REDISH SFA スプレッドシート構成                       │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  【リードソースシート】                                                      │
│  ┌────────────┬────────────┬────────────┬────────────┬────────────┐        │
│  │3.Makuake   │11.Meetsmore│12.TEMPOS   │14.OMC      │15.Amazon   │        │
│  └─────┬──────┴─────┬──────┴─────┬──────┴─────┬──────┴─────┬──────┘        │
│        │            │            │            │            │               │
│        └────────────┴────────────┼────────────┴────────────┘               │
│                                  ▼                                         │
│  【営業管理シート】                                                          │
│  ┌────────────────────────────────────────────────────────────────┐        │
│  │                        架電管理表                              │        │
│  │  ・リード集約  ・架電ステータス管理  ・アポ獲得管理             │        │
│  └────────────────────────────┬───────────────────────────────────┘        │
│                               │ アポ獲得                                   │
│                               ▼                                            │
│  ┌────────────────────────────────────────────────────────────────┐        │
│  │                        商談管理表                              │        │
│  │  ・商談進捗管理  ・確度管理  ・成約/失注管理                    │        │
│  └────────────────────────────┬───────────────────────────────────┘        │
│                               │ 成約                                       │
│                               ▼                                            │
│  ┌────────────────────────────────────────────────────────────────┐        │
│  │                        成約管理表                              │        │
│  │  ・成約データ集約  ・契約準備                                  │        │
│  └────────────────────────────┬───────────────────────────────────┘        │
│                               │ 契約処理                                   │
│                               ▼                                            │
│  ┌────────────────────────────────────────────────────────────────┐        │
│  │                    契約シート（契約フォーム）                    │        │
│  │  ・契約書類作成  ・PDF生成（R/C/Fシート）                       │        │
│  └────────────────────────────────────────────────────────────────┘        │
│                                                                             │
│  【分析シート】                                                              │
│  ┌────────────────────────┬────────────────────────┐                       │
│  │       F分析            │        S分析           │                       │
│  │  ・期間サマリー        │   ・日別時系列         │                       │
│  │  ・担当者別            │   ・トレンド分析       │                       │
│  └────────────────────────┴────────────────────────┘                       │
│                                                                             │
│  【外部連携スプレッドシート】                                                │
│  ┌────────────────────────┬────────────────────────┐                       │
│  │    顧客リード/TR       │      契約データ        │                       │
│  │  (テレマ連携用)        │    (契約履歴蓄積)      │                       │
│  └────────────────────────┴────────────────────────┘                       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 GAS機能マッピング

| # | GAS機能 | トリガー | 処理内容 |
|---|---------|----------|----------|
| 1 | タイムスタンプ記録 | 時間トリガー(1分) | 15.AmazonシートのC列新規IDにA列タイムスタンプ記録 |
| 2 | 新規リード集約 | メニューボタン | 5シート→架電管理表へ新規リード転記 |
| 3 | TM連携同期 | メニューボタン | 架電管理表→外部SS(顧客リード/TR)へ同期 |
| 4 | 契約データ転記 | メニューボタン | 契約シート→外部SS(契約データ)へ蓄積 |
| 5 | PDF生成 | 上記と連続 | R/C/Fシートを個別PDF化してダウンロード |
| 6 | ID自動採番 | onEdit | Meetsmoreシート チェック→C列ID採番(MT0001) |
| 7 | 商談ステータス自動更新 | onEdit | 商談管理表 AS列変更→AI列に結果自動入力 |
| 8 | 成約データ転記 | メニューボタン | 成約管理表→契約シートへ商談IDでマッピング転記 |
| 9 | 契約フォームクリア | メニューボタン | 契約シートF列の特定範囲をクリア |
| 10 | 顧客コード採番 | 手動実行 | F7(事業種別)に応じてA/B+6桁コード生成 |
| 11 | F分析更新 | メニューボタン | 商談・架電管理表→F分析シートへ期間集計 |
| 12 | S分析更新 | メニューボタン | 商談・架電管理表→S分析シートへ日別集計 |
| 13 | 商談管理表転記 | メニューボタン | 架電管理表→商談管理表へアポ獲得データ転記 |
| 14 | 成約管理表転記 | メニューボタン | 商談管理表→成約管理表へ成約データ転記/更新 |

### 2.3 ID体系

| ID種別 | 形式 | 生成場所 | 用途 |
|--------|------|----------|------|
| リードID(MT) | MT0001〜 | 11.Meetsmore | Meetsmoreリード識別 |
| リードID(TP) | TP0001〜 | 12.TEMPOS | TEMPOSリード識別 |
| リードID(OM) | OM0001〜 | 14.OMC | OMCリード識別 |
| リードID(AM) | AM0001〜 | 15.Amazon | Amazonリード識別 |
| リードID(MK) | MK0001〜 | 3.Makuake | Makuakeリード識別 |
| 商談ID | SA0001〜 | 商談管理表 | 商談識別 |
| 成約ID | CN0001〜 | 成約管理表 | 成約識別 |
| 顧客コード(飲食) | A000001〜 | 契約シート | 飲食顧客識別 |
| 顧客コード(非飲食) | B000001〜 | 契約シート | 非飲食顧客識別 |

### 2.4 ステータス遷移

```
【架電ステータス】
未架電 → 架電中 → 03.アポイント獲得済 / 09.アポ獲得 / 失注

【商談ステータス】
新規商談 → 商談進行中 → 01.成約（契約締結）
                      → 02.失注（リサイクル対象外）
                      → 03.失注（リサイクル対象）

【確度】
A:80% / B:50% / C:20% / D:10%

【失注理由】
A.自己対応 / B.競合決定 / C.予算 / D.時期 / E.ニーズ訴求不足
F.(超)小規模店 / G.興味本位 / H.ノーショー / I.弊社対応不可 / J.その他
```

---

## 3. 目標システム設計（To-Be）

### 3.1 システムアーキテクチャ

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           システムアーキテクチャ                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  【クライアント層】                                                          │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    Webアプリケーション（SPA）                        │   │
│  │  ┌──────────┬──────────┬──────────┬──────────┬──────────┐          │   │
│  │  │ダッシュ  │リード    │架電管理  │商談管理  │成約/契約 │          │   │
│  │  │ボード    │管理      │          │          │管理      │          │   │
│  │  └──────────┴──────────┴──────────┴──────────┴──────────┘          │   │
│  │                                                                     │   │
│  │  技術スタック: React + TypeScript + TailwindCSS                     │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                        │
│                                    │ HTTPS                                  │
│                                    ▼                                        │
│  【API層】                                                                   │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      Next.js API Routes / Express                   │   │
│  │  ┌──────────┬──────────┬──────────┬──────────┬──────────┐          │   │
│  │  │認証API   │リードAPI │架電API   │商談API   │分析API   │          │   │
│  │  └──────────┴──────────┴──────────┴──────────┴──────────┘          │   │
│  │                                                                     │   │
│  │  ・ビジネスロジック（旧GAS相当）                                    │   │
│  │  ・ID自動採番                                                       │   │
│  │  ・ステータス遷移管理                                               │   │
│  │  ・バリデーション                                                   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                    │                                        │
│                                    │ Google Sheets API                      │
│                                    ▼                                        │
│  【データ層】                                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    Google Spreadsheet (既存)                        │   │
│  │  ┌──────────┬──────────┬──────────┬──────────┬──────────┐          │   │
│  │  │リード    │架電管理  │商談管理  │成約管理  │契約      │          │   │
│  │  │ソース    │表        │表        │表        │シート    │          │   │
│  │  └──────────┴──────────┴──────────┴──────────┴──────────┘          │   │
│  │                                                                     │   │
│  │  外部SS: 顧客リード/TR、契約データ                                  │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 技術スタック（推奨）

| レイヤー | 技術 | 選定理由 |
|----------|------|----------|
| **フロントエンド** | Next.js 14 + React 18 | SSR/CSR柔軟、API Routes統合 |
| **UIライブラリ** | TailwindCSS + shadcn/ui | 高速開発、モダンUI |
| **状態管理** | TanStack Query (React Query) | サーバー状態管理、キャッシュ |
| **フォーム** | React Hook Form + Zod | バリデーション、型安全 |
| **認証** | NextAuth.js + Google OAuth | Google連携、既存アカウント活用 |
| **API** | Next.js API Routes | フロントと統合、サーバーレス |
| **Sheets連携** | googleapis (google-spreadsheet) | 公式SDK、型サポート |
| **PDF生成** | react-pdf / puppeteer | 契約書類PDF化 |
| **ホスティング** | Vercel | Next.js最適化、自動デプロイ |

### 3.3 認証・認可設計

```
【認証フロー】
1. Google OAuthでログイン
2. 許可されたドメイン(@redish.co.jp等)のみアクセス可
3. JWTトークンでセッション管理

【権限レベル】（将来拡張）
- Admin: 全機能アクセス、設定変更
- Manager: 全データ閲覧、分析機能
- Sales: 担当リード・商談の操作
- Viewer: 閲覧のみ
```

---

## 4. 機能要件

### 4.1 機能一覧

#### 4.1.1 ダッシュボード

| 機能ID | 機能名 | 優先度 | 説明 |
|--------|--------|--------|------|
| DASH-01 | KPIサマリー | 高 | 商談数/成約数/失注数/転換率をリアルタイム表示 |
| DASH-02 | チャネル別パフォーマンス | 高 | 7チャネルのリード→成約ファネル |
| DASH-03 | 日別トレンドグラフ | 中 | S分析相当の時系列可視化 |
| DASH-04 | 担当者別実績 | 中 | 担当者ごとのKPI比較 |
| DASH-05 | アラート表示 | 低 | 未対応リード、期限超過商談の警告 |

#### 4.1.2 リード管理

| 機能ID | 機能名 | 優先度 | 説明 |
|--------|--------|--------|------|
| LEAD-01 | リードソース別一覧 | 高 | 5シートのリードを統合表示 |
| LEAD-02 | リード詳細表示 | 高 | 個別リード情報の閲覧 |
| LEAD-03 | リード承認（ID採番） | 高 | チェック→自動ID採番（旧GAS#6相当） |
| LEAD-04 | タイムスタンプ自動記録 | 高 | 新規リード登録時の自動日時記録 |
| LEAD-05 | 架電管理表への集約 | 高 | 承認済リードの自動集約（旧GAS#2相当） |
| LEAD-06 | リード検索・フィルタ | 中 | 条件検索、ステータスフィルタ |
| LEAD-07 | リード編集 | 中 | 情報更新機能 |
| LEAD-08 | 一括操作 | 低 | 複数リードの一括承認等 |

#### 4.1.3 架電管理

| 機能ID | 機能名 | 優先度 | 説明 |
|--------|--------|--------|------|
| CALL-01 | 架電リスト表示 | 高 | 架電管理表データの一覧表示 |
| CALL-02 | 架電ステータス更新 | 高 | 未架電→架電中→アポ獲得等 |
| CALL-03 | アポ獲得処理 | 高 | アポ獲得時の商談管理表転記（旧GAS#13相当） |
| CALL-04 | 外部連携同期 | 中 | 顧客リード/TRシートへの同期（旧GAS#3相当） |
| CALL-05 | 架電履歴記録 | 中 | 架電日時・結果の履歴管理 |
| CALL-06 | リードソース別集計 | 中 | チャネル別の架電状況サマリー |

#### 4.1.4 商談管理

| 機能ID | 機能名 | 優先度 | 説明 |
|--------|--------|--------|------|
| DEAL-01 | 商談一覧表示 | 高 | 商談管理表データの一覧表示 |
| DEAL-02 | 商談詳細表示 | 高 | 個別商談情報の閲覧 |
| DEAL-03 | 商談ID自動採番 | 高 | SA+4桁の自動採番 |
| DEAL-04 | ステータス更新 | 高 | 商談進捗の更新 |
| DEAL-05 | 成約/失注処理 | 高 | 結果入力と自動分類（旧GAS#7相当） |
| DEAL-06 | 確度管理 | 高 | A/B/C/D確度の設定・更新 |
| DEAL-07 | 失注理由入力 | 高 | 失注時の理由選択 |
| DEAL-08 | サービス/カテゴリ自動設定 | 中 | リードソースに応じた自動分類 |
| DEAL-09 | 商談検索・フィルタ | 中 | 条件検索、ステータス/確度フィルタ |
| DEAL-10 | 商談編集 | 中 | 情報更新機能 |

#### 4.1.5 成約・契約管理

| 機能ID | 機能名 | 優先度 | 説明 |
|--------|--------|--------|------|
| CONT-01 | 成約一覧表示 | 高 | 成約管理表データの一覧表示 |
| CONT-02 | 成約ID自動採番 | 高 | CN+4桁の自動採番 |
| CONT-03 | 成約データ同期 | 高 | 商談管理表との同期更新（旧GAS#14相当） |
| CONT-04 | 契約フォーム入力 | 高 | 契約シートへのデータ入力UI |
| CONT-05 | 契約データ転記 | 高 | 成約管理表→契約シートへの転記（旧GAS#8相当） |
| CONT-06 | 顧客コード採番 | 高 | A/B+6桁の自動採番（旧GAS#10相当） |
| CONT-07 | 契約フォームクリア | 中 | 新規契約準備（旧GAS#9相当） |
| CONT-08 | PDF書類生成 | 中 | R/C/Fシート相当のPDF生成（旧GAS#4,5相当） |
| CONT-09 | 契約データ蓄積 | 中 | 外部SS(契約データ)への保存 |

#### 4.1.6 分析・レポート

| 機能ID | 機能名 | 優先度 | 説明 |
|--------|--------|--------|------|
| ANAL-01 | F分析（期間サマリー） | 高 | 期間指定での集計表示（旧GAS#11相当） |
| ANAL-02 | S分析（日別集計） | 高 | 日別の詳細集計表示（旧GAS#12相当） |
| ANAL-03 | チャネル別分析 | 中 | リードソース別パフォーマンス |
| ANAL-04 | 失注理由分析 | 中 | 失注理由の内訳・トレンド |
| ANAL-05 | 担当者別分析 | 中 | 個人パフォーマンス比較 |
| ANAL-06 | レポートエクスポート | 低 | CSV/Excel形式でのエクスポート |

### 4.2 画面一覧

| 画面ID | 画面名 | 主要機能 |
|--------|--------|----------|
| SCR-01 | ログイン画面 | Google OAuth認証 |
| SCR-02 | ダッシュボード | KPI表示、アラート、クイックアクション |
| SCR-03 | リード一覧 | リード検索・フィルタ・操作 |
| SCR-04 | リード詳細 | リード情報表示・編集 |
| SCR-05 | 架電管理一覧 | 架電リスト、ステータス更新 |
| SCR-06 | 架電詳細 | 架電記録、アポ獲得処理 |
| SCR-07 | 商談一覧 | 商談検索・フィルタ・パイプライン表示 |
| SCR-08 | 商談詳細 | 商談情報表示・編集・ステータス更新 |
| SCR-09 | 成約一覧 | 成約データ一覧 |
| SCR-10 | 契約フォーム | 契約情報入力・PDF生成 |
| SCR-11 | F分析画面 | 期間サマリー、担当者フィルタ |
| SCR-12 | S分析画面 | 日別時系列、トレンドグラフ |
| SCR-13 | 設定画面 | ユーザー設定、マスタ管理 |

---

## 5. 非機能要件

### 5.1 性能要件

| 項目 | 要件 |
|------|------|
| 画面表示速度 | 初期表示3秒以内、データ更新1秒以内 |
| 同時接続数 | 10ユーザー程度（営業チーム規模） |
| データ量 | 年間1万件程度のリード・商談想定 |
| API応答時間 | 平均500ms以内 |

### 5.2 可用性要件

| 項目 | 要件 |
|------|------|
| 稼働時間 | 営業時間（平日9:00-18:00）は99%以上 |
| バックアップ | スプレッドシートのバージョン履歴を活用 |
| 障害復旧 | 4時間以内の復旧目標 |

### 5.3 セキュリティ要件

| 項目 | 要件 |
|------|------|
| 認証 | Google OAuth 2.0（企業ドメイン制限） |
| 通信 | HTTPS必須（TLS 1.2以上） |
| APIアクセス | サービスアカウント or OAuth2.0トークン |
| 監査ログ | 重要操作のログ記録 |

### 5.4 運用保守要件

| 項目 | 要件 |
|------|------|
| 監視 | Vercel Analytics、エラー監視（Sentry等） |
| デプロイ | GitHubプッシュで自動デプロイ |
| 環境 | 開発/ステージング/本番の3環境 |

---

## 6. データ設計

### 6.1 スプレッドシート・API マッピング

既存のカラムID体系を活用し、APIでのデータアクセスを設計。

```typescript
// シート定義
const SHEETS = {
  LEAD_MEETSMORE: { name: '11.Meetsmore', idRow: 1, headerRow: 5, dataStartRow: 6 },
  LEAD_TEMPOS: { name: '12.TEMPOS', idRow: 1, headerRow: 5, dataStartRow: 6 },
  LEAD_OMC: { name: '14.OMC', idRow: 1, headerRow: 5, dataStartRow: 6 },
  LEAD_AMAZON: { name: '15.Amazon', idRow: 1, headerRow: 5, dataStartRow: 6 },
  LEAD_MAKUAKE: { name: '3.Makuake', idRow: 1, headerRow: 5, dataStartRow: 6 },
  CALL_MANAGEMENT: { name: '架電管理表', idRow: 1, headerRow: 8, dataStartRow: 9 },
  DEAL_MANAGEMENT: { name: '商談管理表', idRow: 1, headerRow: 8, dataStartRow: 9 },
  CONTRACT_MANAGEMENT: { name: '成約管理表', idRow: 1, headerRow: 8, dataStartRow: 9 },
  CONTRACT_FORM: { name: '契約', idRow: null, headerRow: null, dataStartRow: 4 },
  F_ANALYSIS: { name: 'F分析', idRow: 28, headerRow: 29, dataStartRow: 30 },
  S_ANALYSIS: { name: 'S分析', idRow: null, headerRow: 7, dataStartRow: 8 },
};

// 主要カラムID（既存GASから抽出）
const COLUMN_IDS = {
  LEAD_ID: 'K01',           // リードID
  LEAD_SOURCE: 'K02',       // リードソース
  LINK_DATE: 'K04',         // 連携日
  APPT_STATUS: 'K16',       // アポステータス
  SETUP_DATE: 'K23',        // 商談設定日
  STAFF: 'S02',             // 担当者
  DETAIL_RANK: 'S04',       // 詳細確度
  RANK: 'S06',              // 確度
  RESULT: 'S16',            // 商談結果
  LOST_REASON: 'S18',       // 失注理由
  DEAL_DATE: 'S22',         // 商談実施日
};
```

### 6.2 APIエンドポイント設計

```
【リード管理】
GET    /api/leads                    # リード一覧取得
GET    /api/leads/:source            # ソース別リード一覧
GET    /api/leads/:source/:id        # リード詳細
POST   /api/leads/:source            # リード登録
PUT    /api/leads/:source/:id        # リード更新
POST   /api/leads/:source/:id/approve # リード承認（ID採番）
POST   /api/leads/aggregate          # 架電管理表への集約

【架電管理】
GET    /api/calls                    # 架電リスト一覧
GET    /api/calls/:id                # 架電詳細
PUT    /api/calls/:id                # 架電更新
POST   /api/calls/:id/appointment    # アポ獲得処理
POST   /api/calls/sync-external      # 外部SS同期

【商談管理】
GET    /api/deals                    # 商談一覧
GET    /api/deals/:id                # 商談詳細
POST   /api/deals                    # 商談登録（アポ→商談転記）
PUT    /api/deals/:id                # 商談更新
POST   /api/deals/:id/close          # 成約/失注処理

【成約・契約管理】
GET    /api/contracts                # 成約一覧
GET    /api/contracts/:id            # 成約詳細
POST   /api/contracts/sync           # 商談→成約同期
GET    /api/contract-form            # 契約フォーム取得
PUT    /api/contract-form            # 契約フォーム更新
POST   /api/contract-form/clear      # 契約フォームクリア
POST   /api/contract-form/transfer   # 成約→契約フォーム転記
POST   /api/contract-form/generate-pdf # PDF生成
POST   /api/customers/code           # 顧客コード採番

【分析】
GET    /api/analysis/f               # F分析データ取得
GET    /api/analysis/s               # S分析データ取得
POST   /api/analysis/f/refresh       # F分析更新
POST   /api/analysis/s/refresh       # S分析更新
```

---

## 7. データ移行計画

### 7.1 移行方針

既存スプレッドシートをそのままデータストアとして使用するため、**データ移行は不要**。
ただし、以下の準備作業が必要：

### 7.2 移行準備作業

#### Phase 0: 環境準備（1週間）

```
1. Google Cloud Projectセットアップ
   ├─ プロジェクト作成
   ├─ Google Sheets API有効化
   ├─ サービスアカウント作成
   └─ 認証情報取得

2. スプレッドシート権限設定
   ├─ サービスアカウントに編集権限付与
   ├─ 外部SS（顧客リード/TR、契約データ）にも権限付与
   └─ アクセステスト実施

3. 既存GASの無効化準備
   ├─ 各トリガーの一覧作成
   ├─ 無効化手順書作成
   └─ ロールバック手順書作成
```

#### 7.3 移行スクリプト

```javascript
// migration/validate-data.js
// 既存データの整合性チェックスクリプト

async function validateExistingData() {
  const checks = [
    // IDの重複チェック
    { sheet: '架電管理表', column: 'K01', name: 'リードID' },
    { sheet: '商談管理表', column: 'B', name: '商談ID' },
    { sheet: '成約管理表', column: 'B', name: '成約ID' },
  ];

  for (const check of checks) {
    const duplicates = await findDuplicateIds(check.sheet, check.column);
    if (duplicates.length > 0) {
      console.warn(`⚠️ ${check.name} 重複あり:`, duplicates);
    } else {
      console.log(`✅ ${check.name} 重複なし`);
    }
  }

  // カラムID存在チェック
  const requiredColumnIds = ['K01', 'K02', 'K04', 'K16', 'S02', 'S16', 'S22'];
  for (const colId of requiredColumnIds) {
    const exists = await checkColumnIdExists('商談管理表', colId);
    console.log(`${exists ? '✅' : '❌'} カラムID ${colId}`);
  }
}

// migration/disable-gas-triggers.js
// GASトリガー無効化スクリプト

function disableAllTriggers() {
  const triggers = ScriptApp.getProjectTriggers();
  const disabledTriggers = [];
  
  triggers.forEach(trigger => {
    const info = {
      functionName: trigger.getHandlerFunction(),
      triggerType: trigger.getTriggerSource(),
      id: trigger.getUniqueId()
    };
    disabledTriggers.push(info);
    ScriptApp.deleteTrigger(trigger);
    console.log(`無効化: ${info.functionName}`);
  });
  
  // 復元用に保存
  PropertiesService.getScriptProperties()
    .setProperty('DISABLED_TRIGGERS', JSON.stringify(disabledTriggers));
  
  return disabledTriggers;
}

function restoreAllTriggers() {
  // ロールバック用
  const saved = PropertiesService.getScriptProperties()
    .getProperty('DISABLED_TRIGGERS');
  // ... 復元処理
}
```

### 7.4 移行チェックリスト

```
□ Phase 0: 環境準備
  □ GCPプロジェクト作成完了
  □ Sheets API有効化完了
  □ サービスアカウント作成完了
  □ 認証情報取得完了
  □ スプレッドシート権限付与完了
  □ API接続テスト完了

□ Phase 1: データ検証
  □ 全シートのカラムID確認
  □ ID重複チェック完了
  □ ステータス値の正規化確認
  □ 日付形式の確認

□ Phase 2: 並行運用準備
  □ Webアプリ本番環境構築
  □ 読み取りテスト完了
  □ 書き込みテスト完了（テストデータ）

□ Phase 3: 切り替え
  □ GASトリガー無効化
  □ Webアプリ本番リリース
  □ 動作確認（全機能）
  □ ユーザー通知

□ Phase 4: 安定化
  □ 1週間監視
  □ 問題対応
  □ GASコード完全削除（または保存）
```

---

## 8. 開発フェーズ・スケジュール

### 8.1 フェーズ構成

```
Phase 1: 基盤構築・リード管理（4週間）
├─ Week 1-2: プロジェクトセットアップ、認証、API基盤
├─ Week 3: リード一覧・詳細画面
└─ Week 4: リード承認・集約機能

Phase 2: 架電・商談管理（4週間）
├─ Week 5-6: 架電管理機能
├─ Week 7-8: 商談管理機能
└─ 並行: 外部SS同期機能

Phase 3: 成約・契約管理（3週間）
├─ Week 9-10: 成約管理、契約フォーム
└─ Week 11: PDF生成、顧客コード採番

Phase 4: 分析・ダッシュボード（3週間）
├─ Week 12: F分析機能
├─ Week 13: S分析機能
└─ Week 14: ダッシュボード

Phase 5: テスト・移行・リリース（2週間）
├─ Week 15: 総合テスト、データ検証
└─ Week 16: 本番移行、ユーザートレーニング

合計: 約16週間（4ヶ月）
```

### 8.2 マイルストーン

| マイルストーン | 時期 | 成果物 |
|---------------|------|--------|
| M1: 基盤完成 | Week 2 | 認証、API基盤、Sheets接続 |
| M2: リード管理完成 | Week 4 | リード機能一式 |
| M3: 架電管理完成 | Week 6 | 架電機能一式 |
| M4: 商談管理完成 | Week 8 | 商談機能一式 |
| M5: 契約管理完成 | Week 11 | 成約・契約機能一式 |
| M6: 分析機能完成 | Week 14 | 分析・ダッシュボード |
| M7: 本番リリース | Week 16 | 本番環境稼働 |

---

## 9. リスクと対策

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| Sheets API制限超過 | 高 | 中 | キャッシュ層導入、リクエスト最適化 |
| 既存GASとの競合 | 高 | 高 | GAS無効化を確実に実施、並行運用期間設定 |
| データ不整合 | 高 | 中 | トランザクション的処理、整合性チェック |
| ユーザー抵抗 | 中 | 中 | 段階的移行、トレーニング実施 |
| 認証トラブル | 中 | 低 | 認証の冗長化、トークンリフレッシュ |

---

## 10. 将来拡張

### 10.1 Phase 2以降の検討事項

1. **DB移行**: 
   - スプレッドシート → PostgreSQL/Supabase
   - 移行スクリプト自動化
   - パフォーマンス向上

2. **モバイルアプリ**:
   - React Native or PWA
   - 外出先での商談記録

3. **自動化拡張**:
   - リマインダー通知
   - 架電スケジュール最適化
   - AI確度予測

4. **連携拡張**:
   - Slack通知
   - カレンダー連携
   - 請求システム連携

---

## 11. 付録

### 11.1 用語集

| 用語 | 説明 |
|------|------|
| リードソース | リード獲得チャネル（TEMPOS, OMC, Meetsmore, Amazon, Makuake, REDISH） |
| 架電管理表 | リードへの架電活動を管理するシート |
| 商談管理表 | アポ獲得後の商談進捗を管理するシート |
| 成約管理表 | 成約した商談のデータを集約するシート |
| F分析 | Field Sales Analysis（期間サマリー型分析） |
| S分析 | Sales Analysis（日別時系列分析） |
| カラムID | スプレッドシート1行目に定義された列識別子（K01, S02等） |

### 11.2 参考資料

- 既存GASコード分析結果（本ドキュメント作成時に分析）
- Google Sheets API ドキュメント
- Next.js ドキュメント

---

**ドキュメント作成日**: 2024年12月7日  
**作成者**: AI Assistant  
**バージョン**: 1.0
